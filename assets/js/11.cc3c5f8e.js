(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{715:function(s,e,n){s.exports=n.p+"assets/img/ice.1bff3a20.jpg"},716:function(s,e,n){s.exports=n.p+"assets/img/signal.dbedc6e4.jpg"},717:function(s,e,n){s.exports=n.p+"assets/img/signal2.4eb4cd7a.jpg"},718:function(s,e,n){s.exports=n.p+"assets/img/peer.c25562db.png"},756:function(s,e,n){"use strict";n.r(e);var r=n(5),a=Object(r.a)({},(function(){var s=this,e=s.$createElement,r=s._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"webrtc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#webrtc"}},[s._v("#")]),s._v(" Webrtc")]),s._v(" "),r("p",[s._v("WebRTC是一个由Google发起的实时通讯解决方案，其中包含视频音频采集，编解码，数据传输，音视频展示等功能，我们可以通过技术快速地构建出一个音视频通讯应用。虽然其名为WebRTC，但是实际上它不光支持Web之间的音视频通讯，还支持Android以及IOS端，此外由于该项目是开源的，我们也可以通过编译C++代码，从而达到全平台的互通。")]),s._v(" "),r("h2",{attrs:{id:"源码地址"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#源码地址"}},[s._v("#")]),s._v(" 源码地址")]),s._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/zz-media/webrtc",target:"_blank",rel:"noopener noreferrer"}},[s._v("DEMO"),r("OutboundLink")],1)]),s._v(" "),r("h2",{attrs:{id:"交互流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#交互流程"}},[s._v("#")]),s._v(" 交互流程")]),s._v(" "),r("h3",{attrs:{id:"ice整体流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ice整体流程"}},[s._v("#")]),s._v(" ice整体流程")]),s._v(" "),r("p",[r("img",{attrs:{src:n(715),alt:"ice流程"}})]),s._v(" "),r("h3",{attrs:{id:"信令流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#信令流程"}},[s._v("#")]),s._v(" 信令流程")]),s._v(" "),r("p",[r("img",{attrs:{src:n(716),alt:"ice流程"}}),s._v(" "),r("img",{attrs:{src:n(717),alt:"信令说明"}})]),s._v(" "),r("h3",{attrs:{id:"连接建立流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#连接建立流程"}},[s._v("#")]),s._v(" 连接建立流程:")]),s._v(" "),r("p",[r("img",{attrs:{src:n(718),alt:"连接建立"}})]),s._v(" "),r("h2",{attrs:{id:"服务搭建"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#服务搭建"}},[s._v("#")]),s._v(" 服务搭建")]),s._v(" "),r("h3",{attrs:{id:"coturn"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#coturn"}},[s._v("#")]),s._v(" coturn")]),s._v(" "),r("h4",{attrs:{id:"turnserver-conf配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#turnserver-conf配置"}},[s._v("#")]),s._v(" turnserver.conf配置")]),s._v(" "),r("p",[s._v("vi /build/coturn/turnserver.conf\ndocker启动host")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker run -d --name turn --network=host -v /build/coturn/turnserver.conf:/etc/coturn/turnserver.conf coturn/coturn\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("docker启动network")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("realm=ruijie.asia\nlistening-port=3478\nexternal-ip=124.220.1.36\nlt-cred-mech\nuser=admin:123456\n#cli-password=654321\nmin-port=60000\nmax-port=60100\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker stop turn && docker rm turn\ndocker run -d --name turn -p 3478:3478 -p 3478:3478/udp -p 5349:5349 -p 5349:5349/udp -p 60000-60100:60000-60100/udp -v /build/coturn/turnserver.conf:/etc/coturn/turnserver.conf coturn/coturn\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h4",{attrs:{id:"turnserver-conf加密配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#turnserver-conf加密配置"}},[s._v("#")]),s._v(" turnserver.conf加密配置")]),s._v(" "),r("p",[s._v("进入docker容器生成秘钥")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("openssl req -x509 -newkey rsa:2048 -keyout /build/coturn/turn_server_pkey.pem -out /build/coturn/turn_server_cert.pem -days 99999 -nodes\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("realm=ruijie.asia\nlistening-port=3478\ntls-listening-port=5349\nexternal-ip=124.220.1.36\nlt-cred-mech\nuser=admin:123456\n#cli-password=654321\nmin-port=60000\nmax-port=60100\ncert=/etc/coturn/turn_server_cert.pem\npkey=/etc/coturn/turn_server_pkey.pem\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("p",[s._v("docker启动host")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker run -d --name turn --network=host -v /build/coturn/:/etc/coturn/ coturn/coturn\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("docker启动network")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker run -d --name turn --network=server-network -p 3478:3478 -p 3478:3478/udp -p 5349:5349 -p 5349:5349/udp -p 60000-60100:60000-60100/udp -v /build/coturn/:/etc/coturn/ coturn/coturn\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h4",{attrs:{id:"turnserver-conf-redis配置、web配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#turnserver-conf-redis配置、web配置"}},[s._v("#")]),s._v(" turnserver.conf redis配置、web配置")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('realm=ruijie.asia\nlistening-port=3478\ntls-listening-port=5349\nexternal-ip=124.220.1.36\nlt-cred-mech\nuser=admin:123456\n#cli-password=654321\nmin-port=60000\nmax-port=60100\ncert=/etc/coturn/turn_server_cert.pem\npkey=/etc/coturn/turn_server_pkey.pem\nredis-userdb="ip=redis dbname=5 port=6379 password=zz@Redis connect_timeout=30"\nredis-statsdb="ip=redis dbname=6 port=6379 password=zz@Redis connect_timeout=30"\nweb-admin\nweb-admin-port=8080\nweb-admin-ip=0.0.0.0\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('docker run -d -p 6379:6379 --name redis --network=server-network redis:6.0.1 --requirepass "zz@Redis"\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker run -d --name turn --network=server-network -p 8080:8080 -p 3478:3478 -p 3478:3478/udp -p 5349:5349 -p 5349:5349/udp -p 60000-60100:60000-60100/udp -v /build/coturn/:/etc/coturn/ coturn/coturn\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("redis中添加turn用户")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('turnadmin -a -N "ip=redis dbname=5 port=6379 password=zz@Redis  connect_timeout=30" -u userzz -r ruijie.asia -p zzuser\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("redis中添加admin用户")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('turnadmin -A -N "ip=redis dbname=5 port=6379 password=zz@Redis  connect_timeout=30" -u adminzz -r ruijie.asia -p zzadmin\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("验证数据库中是否添加成功")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('turnadmin -l --redis-userdb="ip=redis dbname=5 port=6379 password=zz@Redis  connect_timeout=30"\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h4",{attrs:{id:"turnserver-conf-动态秘钥"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#turnserver-conf-动态秘钥"}},[s._v("#")]),s._v(" turnserver.conf 动态秘钥")]),s._v(" "),r("p",[s._v("方案：redis保存临时用户，参考https://blog.csdn.net/anshichuxuezhe/article/details/128430147\njava md5生成代码")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('        String username = "usertest";\n        String realm = "ruijie.asia";\n        String password = "usertest";\n        String input = username + ":" + realm + ":" + password;\n        try {\n            MessageDigest md = MessageDigest.getInstance("MD5");\n            byte[] inputBytes = input.getBytes();\n            byte[] hashBytes = md.digest(inputBytes);\n            StringBuilder hexString = new StringBuilder();\n            for (byte hashByte : hashBytes) {\n                hexString.append(String.format("%02x", hashByte));\n            }\n            System.out.println(username +" MD5 Hash: " + hexString.toString());\n        } catch (NoSuchAlgorithmException e) {\n            e.printStackTrace();\n        }\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br")])]),r("h3",{attrs:{id:"nginx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" nginx")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker network ls\n创建网络\ndocker network create -d bridge server-network\ndocker run -d -p 80:80 --name mynginx nginx\n查看nginx的配置文件目录\ndocker exec -it mynginx /bin/bash\ndocker cp -a mynginx:/etc/nginx/ /build/nginx/conf/\ndocker cp -a mynginx:/usr/share/nginx/html/ /build/nginx/html/\ndocker stop mynginx\ndocker rm mynginx\ndocker run -d -p 80:80 -p 443:443 -v /build/nginx/html/:/usr/share/nginx/html/ -v /build/nginx/conf/:/etc/nginx/ --name nginx --network server-network nginx\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("p",[s._v("访问测试 http://ruijie.asia\n申请SSL证书并放在/etc/nginx/目录下\nconf配置")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("server {\n    listen       443 ssl;\n    server_name  localhost;\n    charset 'utf-8';\n    ssl_certificate      ruijie.asia.crt;\n    ssl_certificate_key  ruijie.asia.key;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n}\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br")])]),r("p",[s._v("访问测试 https://ruijie.asia")]),s._v(" "),r("h3",{attrs:{id:"server-java"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server-java"}},[s._v("#")]),s._v(" server-java")]),s._v(" "),r("p",[s._v("编译demo工程 https://github.com/zz-media/webrtc/tree/main/server-java")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker run -d -p 18080:18080 -p 19000:19000 -v /build/server-java:/usr/local/app --name server-java --network server-network openjdk:8u272-jdk  java -jar -server -Xms256M -Xmx512M /usr/local/app/server-java.jar\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("ng conf新增配置")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('server {\n    location /socket.io/ {\n        # socket所在ip和端口号\n        proxy_pass http://server-java:19000/socket.io/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n    } \n}\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("h3",{attrs:{id:"client-vue"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#client-vue"}},[s._v("#")]),s._v(" client-vue")]),s._v(" "),r("p",[s._v("编译demo工程 https://github.com/zz-media/webrtc/tree/main/server-java\n放到ng目录下\n访问 https://124.220.1.36/media-web")])])}),[],!1,null,null,null);e.default=a.exports}}]);